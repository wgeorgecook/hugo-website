<!doctype html><html lang=en><head><title>Go_generate_protobuf :: </title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Using Go Generate to Compile Proto Files"><meta name=keywords content="go,golang,protobuf,grpc,protoc,proto"><meta name=robots content="noodp"><link rel=canonical href=https://williamcook.dev/posts/go_generate_protobuf/><link rel=stylesheet href=https://williamcook.dev/assets/style.css><link rel=stylesheet href=https://williamcook.dev/assets/pink.css><link rel=apple-touch-icon href=https://williamcook.dev/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://williamcook.dev/img/favicon/pink.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Go_generate_protobuf"><meta property="og:description" content="Using Go Generate to Compile Proto Files"><meta property="og:url" content="https://williamcook.dev/posts/go_generate_protobuf/"><meta property="og:site_name" content><meta property="og:image" content="https://williamcook.dev/img/favicon/pink.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2024-09-03 14:30:59 -0400 -0400"></head><body class=pink><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>William George Cook</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/>About</a></li><li><a href=/contact>Contact</a></li><li><a href=/posts>Posts</a></li><li><a href=/showcase>Public Projects</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/>About</a></li><li><a href=/contact>Contact</a></li><li><a href=/posts>Posts</a></li><li><a href=/showcase>Public Projects</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://williamcook.dev/posts/go_generate_protobuf/>Go_generate_protobuf</a></h1><div class=post-meta><span class=post-date>2024-09-03
</span><span class=post-author>:: William George Cook</span></div><span class=post-tags>#<a href=https://williamcook.dev/tags/go/>go</a>&nbsp;
#<a href=https://williamcook.dev/tags/golang/>golang</a>&nbsp;
#<a href=https://williamcook.dev/tags/build-tools/>build tools</a>&nbsp;
#<a href=https://williamcook.dev/tags/toolchain/>toolchain</a>&nbsp;
#<a href=https://williamcook.dev/tags/protocol-buffers/>protocol buffers</a>&nbsp;
#<a href=https://williamcook.dev/tags/grpc/>grpc</a>&nbsp;</span><div class=post-content><div><h1 id=playground-for-go-generate-using-proto-files>Playground for Go Generate Using Proto Files<a href=#playground-for-go-generate-using-proto-files class=hanchor arialabel=Anchor>&#8983;</a></h1><p>This is a small application to demonstrate how to use <code>go generate</code> to compile proto files into Go code.</p><p>Note: all code is available on GitHub <a href=https://github.com/wgeorgecook/playgen>here</a>.</p><h2 id=go-generate>Go Generate<a href=#go-generate class=hanchor arialabel=Anchor>&#8983;</a></h2><p>The <a href=https://go.dev/blog/generate>original blog post</a> by Rob Pike is well worth a read.
At the bottom, Rob says</p><blockquote><p>Please use go generate creatively. It’s there to encourage experimentation.</p></blockquote><p>This is one such experimentation.</p><h2 id=protobuf-gprc-and-generating-code>Protobuf, gPRC, and Generating Code<a href=#protobuf-gprc-and-generating-code class=hanchor arialabel=Anchor>&#8983;</a></h2><p>If you are unfamiliar with <a href=https://protobuf.dev/>Protocol Buffers</a> and <a href=https://grpc.io/docs/languages/go/quickstart/>gRPC</a>, those linked resources are worth a read. However, just know that Protobuf is a language spec that allows you to define abstract API contracts within generated code stubs. Your application needs to implement these interfaces for clients to consume. The benefit is that both client and server consume and fulfill requests using the same base <code>.proto</code> file and its generated code, allowing for incredible type safety.</p><h2 id=protoc-hassles>Protoc Hassles<a href=#protoc-hassles class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Go developers using Protobuf for a few years are probably familiar with the <code>protoc</code> binary used and the <code>protoc-gen-go</code> plugin. This is the tool we use to generate Go stubs from proto files. Protoc commands can be provided via scripts, in Dockerfiles, or ran directly to ensure that code is generated and types are accessible to your application. This decouples the proto compilation step from your app compilation. If you want to couple the two together, <code>go generate</code> may be your answer.</p><h1 id=go-generate-again>Go Generate (again)<a href=#go-generate-again class=hanchor arialabel=Anchor>&#8983;</a></h1><p>The <code>go generate</code> command searches through your Go files for the <code>//go:generate</code> comment (notice no space between the slashes and <code>go</code>). Adding this tag tells the Go toolchain to run whatever shell commends follow.</p><h2 id=tagging-for-go-generate>Tagging for Go Generate<a href=#tagging-for-go-generate class=hanchor arialabel=Anchor>&#8983;</a></h2><p>You can see here that <code>main.go</code> has two go generate tags.</p><pre tabindex=0><code>//go:generate protoc --go_out=. --go-grpc_out=. proto/helloapis/messages.proto
//go:generate protoc --go_out=. --go-grpc_out=. proto/helloapis/services.proto
</code></pre><p>These two tags will compile protos found in <code>proto/helloapis</code> and move them into the directory indicated by their package name. In this instance, that directory is <code>gen/helloapis/v1</code>.</p><h1 id=building-the-application>Building the Application<a href=#building-the-application class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Attemping to run <code>go build .</code> before compiling the protos will fail.</p><blockquote><p>❯ go build .
client/client.go:6:2: package playgen/gen/helloapis/v1 is not in std (/snap/go/10630/src/playgen/gen/helloapis/v1)</p></blockquote><p>To resolve this, run <code>go generate ./...</code>.</p><blockquote><p>❯ go generate ./&mldr;</p></blockquote><p>Notice that a new <code>gen</code> directory is in the repo root.</p><pre tabindex=0><code>❯ ls
build  client  docker-compose.yaml  gen  go.mod  go.sum  main.go  proto  README.md  server
</code></pre><p>The application is now buildable and runnable!</p><pre tabindex=0><code>❯ go build .
❯ ls
build  client  docker-compose.yaml  gen  go.mod  go.sum  main.go  playgen  proto  README.md  server
❯ ./playgen
Hello, vim-go!
</code></pre></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2025 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://williamcook.dev/assets/main.js></script><script src=https://williamcook.dev/assets/prism.js></script></div></body></html>